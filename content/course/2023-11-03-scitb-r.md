---
title: 首发scitb包，一个为制作统计表格而生的R包
author: 天桥下的卖艺者
date: '2023-11-03'
slug: scitb-r
categories:
  - 统计学
  - scitb
tags:
  - scitb
  - 统计学
  - 基线表格
from_Rmd: yes
---
转自[首发scitb包，一个为制作统计表格而生的R包](https://mp.weixin.qq.com/s/rcztQzTcdgtWZthKVBgYmA)

## 安装代码
可以使用以下代码安装
```
install.packages("scitb")
```
## 数据演示
下面咱们来演示一下咱们使用scitb包来绘制一个咱们论文需要的基线表
scitb包自带早产数据，咱们直接从包调用


```r
library(scitb)
library(stringi)
bc <- prematurity
# head(bc)
```


| id| low| age| lwt|race  |smoke     | ptl| ht| ui| ftv|  bwt|
|--:|---:|---:|---:|:-----|:---------|---:|--:|--:|---:|----:|
| 85|   0|  19| 182|black |nonsmoker |   0|  0|  1|   0| 2523|
| 86|   0|  33| 155|other |nonsmoker |   0|  0|  0|   3| 2551|
| 87|   0|  20| 105|white |smoker    |   0|  0|  0|   1| 2557|
| 88|   0|  21| 108|white |smoker    |   0|  0|  1|   2| 2594|
| 89|   0|  18| 107|white |smoker    |   0|  0|  1|   0| 2600|
| 91|   0|  21| 124|other |nonsmoker |   0|  0|  0|   0| 2622|
这是一个关于早产低体重儿的数据，低于2500g被认为是低体重儿。数据解释如下：
- low 是否是小于2500g早产低体重儿
- age 母亲的年龄
- lwt 末次月经体重
- race 种族
- smoke孕期抽烟
- ptl 早产史（计数）
- ht 有高血压病史
- ui 子宫过敏
- ftv 早孕时看医生的次数
- bwt 新生儿体重数值

### 分类变量

假设咱们想**race**为研究目标，因为它是分类变量，咱们最好把它转成因子，因为**scitb**包有一定对数据类型的判定能力，如果你的分类变量类别大于5个，而你不转成因子的话，它可能自动判定为连续变量，处理方式不一样的，所以这里最好自己设定一下。


```r
bc$race <- as.factor(bc$race)
```

接下来就是定义全部变量，分类变量和分层变量，这和**tableone**包一模一样，如果你会使用**tableone**包，使用**scitb**包起来完全无压力。


```r
allVars <- c("age", "lwt", "smoke", "ptl", "ht", "ui", "ftv", "bwt")
fvars <- c("smoke", "ht", "ui")
strata <- "race"
```

### 一键生成统计结果

```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc)
```


|      |Characteristic |race.black             |race.other             |race.white             |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |26                     |67                     |96                     |        |
|d1    |age            |20.50 (17.25-24.00)    |22.00 (19.00-25.00)    |23.50 (20.00-29.00)    |0.027   |
|d1    |lwt            |129.00 (120.00-179.00) |119.00 (105.00-130.00) |129.50 (112.00-143.25) |<0.001  |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.867   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-1.25)       |0.103   |
|d1    |bwt            |2719.69±638.68         |2804.01±721.30         |3103.01±727.87         |0.008   |
|d2    |smoke          |                       |                       |                       |<0.001  |
|      |nonsmoker      |16 (61.54%)            |55 (82.09%)            |44 (45.83%)            |        |
|      |smoker         |10 (38.46%)            |12 (17.91%)            |52 (54.17%)            |        |
|d2    |ht             |                       |                       |                       |0.496   |
|      |0              |23 (88.46%)            |63 (94.03%)            |91 (94.79%)            |        |
|      |1              |3 (11.54%)             |4 (5.97%)              |5 (5.21%)              |        |
|d2    |ui             |                       |                       |                       |0.653   |
|      |0              |23 (88.46%)            |55 (82.09%)            |83 (86.46%)            |        |
|      |1              |3 (11.54%)             |12 (17.91%)            |13 (13.54%)            |        |

这样结果就生成了，我按论文格式对界面进行设定，这样你几乎不怎么用调整就可以生成数据表一了，省了点时间。如果有非正态数据怎么办，假设lwt为非正态分布数据，咱们通过nonnormal这个参数给它定义一下


```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc, nonnormal = c("lwt"))
```


|      |Characteristic |race.black             |race.other             |race.white             |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |26                     |67                     |96                     |        |
|d1    |age            |20.50 (17.25-24.00)    |22.00 (19.00-25.00)    |23.50 (20.00-29.00)    |0.027   |
|d1    |lwt            |129.00 (120.00-179.00) |119.00 (105.00-130.00) |129.50 (112.00-143.25) |<0.001  |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.867   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-1.25)       |0.103   |
|d1    |bwt            |2719.69±638.68         |2804.01±721.30         |3103.01±727.87         |0.008   |
|d2    |smoke          |                       |                       |                       |<0.001  |
|      |nonsmoker      |16 (61.54%)            |55 (82.09%)            |44 (45.83%)            |        |
|      |smoker         |10 (38.46%)            |12 (17.91%)            |52 (54.17%)            |        |
|d2    |ht             |                       |                       |                       |0.496   |
|      |0              |23 (88.46%)            |63 (94.03%)            |91 (94.79%)            |        |
|      |1              |3 (11.54%)             |4 (5.97%)              |5 (5.21%)              |        |
|d2    |ui             |                       |                       |                       |0.653   |
|      |0              |23 (88.46%)            |55 (82.09%)            |83 (86.46%)            |        |
|      |1              |3 (11.54%)             |12 (17.91%)            |13 (13.54%)            |        |

我们可以看到lwt这里被改成使用中位数和四分位数表示了。

接下来看看咱们算得对不对，使用tableone包来比较一下

```r
library(tableone)
allVars <- c("age", "lwt", "smoke", "ptl", "ht", "ui", "ftv", "bwt")
fvars <- c("smoke", "ht", "ui")
strata <- "race"
tab2 <- CreateTableOne(vars = allVars, factorVars = fvars, strata = strata, data = bc)
# print(tab2)#输出表格，tableone包
```


```
##                     Stratified by race
##                      black            other            white            p     
##   n                       26               67               96                
##   age (mean (SD))      21.54 (5.11)     22.39 (4.54)     24.29 (5.65)    0.016
##   lwt (mean (SD))     146.81 (39.64)   120.03 (25.12)   132.05 (29.09)  <0.001
##   smoke = smoker (%)      10 (38.5)        12 (17.9)        52 (54.2)   <0.001
##   ptl (mean (SD))       0.15 (0.37)      0.21 (0.48)      0.20 (0.54)    0.889
##   ht = 1 (%)               3 (11.5)         4 ( 6.0)         5 ( 5.2)    0.496
##   ui = 1 (%)               3 (11.5)        12 (17.9)        13 (13.5)    0.653
##   ftv (mean (SD))       0.81 (1.10)      0.66 (1.14)      0.89 (0.99)    0.400
##   bwt (mean (SD))    2719.69 (638.68) 2804.01 (721.30) 3103.01 (727.87)  0.008
##                     Stratified by race
##                      test
##   n                      
##   age (mean (SD))        
##   lwt (mean (SD))        
##   smoke = smoker (%)     
##   ptl (mean (SD))        
##   ht = 1 (%)             
##   ui = 1 (%)             
##   ftv (mean (SD))        
##   bwt (mean (SD))
```



|                   |black            |other            |white            |p      |test |
|:------------------|:----------------|:----------------|:----------------|:------|:----|
|n                  |26               |67               |96               |       |     |
|age (mean (SD))    |21.54 (5.11)     |22.39 (4.54)     |24.29 (5.65)     |0.016  |     |
|lwt (mean (SD))    |146.81 (39.64)   |120.03 (25.12)   |132.05 (29.09)   |<0.001 |     |
|smoke = smoker (%) |10 (38.5)        |12 (17.9)        |52 (54.2)        |<0.001 |     |
|ptl (mean (SD))    |0.15 (0.37)      |0.21 (0.48)      |0.20 (0.54)      |0.889  |     |
|ht = 1 (%)         |3 (11.5)         |4 ( 6.0)         |5 ( 5.2)         |0.496  |     |
|ui = 1 (%)         |3 (11.5)         |12 (17.9)        |13 (13.5)        |0.653  |     |
|ftv (mean (SD))    |0.81 (1.10)      |0.66 (1.14)      |0.89 (0.99)      |0.400  |     |
|bwt (mean (SD))    |2719.69 (638.68) |2804.01 (721.30) |3103.01 (727.87) |0.008  |     |

> 对比两个结果，一模一样，所以大家可以完全放心，原作者没有抄袭tableone包，虽然结果一样，但是算法构架完全不一样的，tableone是使用lapply()函数来跑结果的，而本包是使用for循环的。

### 连续变量
**Scitb**包格式更加符合论文发表格式，刚才说了分类变量的制表方法，现在来说下连续变量，假设我们研究的是年龄变量age.

```r
allVars <- c("race", "lwt", "smoke", "ptl", "ht", "ui", "ftv", "bwt")
fvars <- c("smoke", "ht", "ui", "race")
strata <- "age"
## 生成结果
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc)
```

```
##       Min 33.33333% 66.66667%       Max 
##        14        20        25        45
```

```
## Strata is treated as a continuous variable.
```


|      |Characteristic |G.0                    |G.1                    |G.2                    |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |51                     |69                     |69                     |        |
|d1    |lwt            |119.00 (106.00-135.00) |121.00 (110.00-132.00) |130.00 (115.00-153.00) |0.086   |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.171   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-2.00)       |0.011   |
|d1    |bwt            |2974.08±612.51         |2921.42±697.85         |2945.13±839.82         |0.927   |
|d2    |smoke          |                       |                       |                       |0.587   |
|      |nonsmoker      |28 (54.90%)            |44 (63.77%)            |43 (62.32%)            |        |
|      |smoker         |23 (45.10%)            |25 (36.23%)            |26 (37.68%)            |        |
|d2    |ht             |                       |                       |                       |0.929   |
|      |0              |48 (94.12%)            |64 (92.75%)            |65 (94.20%)            |        |
|      |1              |3 (5.88%)              |5 (7.25%)              |4 (5.80%)              |        |
|d2    |ui             |                       |                       |                       |0.873   |
|      |0              |43 (84.31%)            |58 (84.06%)            |60 (86.96%)            |        |
|      |1              |8 (15.69%)             |11 (15.94%)            |9 (13.04%)             |        |
|d2    |race           |                       |                       |                       |0.320   |
|      |black          |10 (19.61%)            |10 (14.49%)            |6 (8.70%)              |        |
|      |other          |18 (35.29%)            |27 (39.13%)            |22 (31.88%)            |        |
|      |white          |23 (45.10%)            |32 (46.38%)            |41 (59.42%)            |        |

可以看到年龄被默认分层3组，然后得出基线表，还给出了具体分割值，表明从14到20到25到45进行了分割，下面的警告不用理会，咱们没有关闭警告，算出来和**tableone**包一样的。

如果你想分层更多组，可以使用num这个制表来设定。假设咱们想生成4组


```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc, num = 4)
```

```
## Min 25% 50% 75% Max 
##  14  19  23  26  45
```

```
## Strata is treated as a continuous variable.
```


|      |Characteristic |G.0                    |G.1                    |G.2                    |G.3                    |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |35                     |59                     |41                     |54                     |        |
|d1    |lwt            |115.00 (105.00-126.00) |125.00 (111.00-148.50) |118.00 (110.00-130.00) |132.50 (120.00-154.00) |0.001   |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.384   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-2.00)       |0.072   |
|d1    |bwt            |2938.51±585.15         |2948.39±664.75         |2877.20±816.71         |2994.48±820.04         |0.896   |
|d2    |smoke          |                       |                       |                       |                       |0.186   |
|      |nonsmoker      |20 (57.14%)            |33 (55.93%)            |31 (75.61%)            |31 (57.41%)            |        |
|      |smoker         |15 (42.86%)            |26 (44.07%)            |10 (24.39%)            |23 (42.59%)            |        |
|d2    |ht             |                       |                       |                       |                       |0.413   |
|      |0              |34 (97.14%)            |53 (89.83%)            |38 (92.68%)            |52 (96.30%)            |        |
|      |1              |1 (2.86%)              |6 (10.17%)             |3 (7.32%)              |2 (3.70%)              |        |
|d2    |ui             |                       |                       |                       |                       |0.277   |
|      |0              |30 (85.71%)            |46 (77.97%)            |37 (90.24%)            |48 (88.89%)            |        |
|      |1              |5 (14.29%)             |13 (22.03%)            |4 (9.76%)              |6 (11.11%)             |        |
|d2    |race           |                       |                       |                       |                       |0.141   |
|      |black          |9 (25.71%)             |7 (11.86%)             |6 (14.63%)             |4 (7.41%)              |        |
|      |other          |13 (37.14%)            |21 (35.59%)            |17 (41.46%)            |16 (29.63%)            |        |
|      |white          |13 (37.14%)            |31 (52.54%)            |18 (43.90%)            |34 (62.96%)            |        |

这里有个制表小技巧回到前面的连续变量里，咱们可以把分层变量加进去，快速制表


```r
allVars <- c("age", "lwt", "smoke", "ptl", "ht", "ui", "ftv", "bwt", "race")
fvars <- c("smoke", "ht", "ui", "race")
strata <- "age"
```

### 一键生成统计结果

```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc)
```

```
##       Min 33.33333% 66.66667%       Max 
##        14        20        25        45
```

```
## Strata is treated as a continuous variable.
```


|      |Characteristic |G.0                    |G.1                    |G.2                    |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |51                     |69                     |69                     |        |
|d1    |age            |18.00 (16.50-19.00)    |22.00 (20.00-23.00)    |28.00 (26.00-31.00)    |<0.001  |
|d1    |lwt            |119.00 (106.00-135.00) |121.00 (110.00-132.00) |130.00 (115.00-153.00) |0.086   |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.171   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-2.00)       |0.011   |
|d1    |bwt            |2974.08±612.51         |2921.42±697.85         |2945.13±839.82         |0.927   |
|d2    |smoke          |                       |                       |                       |0.587   |
|      |nonsmoker      |28 (54.90%)            |44 (63.77%)            |43 (62.32%)            |        |
|      |smoker         |23 (45.10%)            |25 (36.23%)            |26 (37.68%)            |        |
|d2    |ht             |                       |                       |                       |0.929   |
|      |0              |48 (94.12%)            |64 (92.75%)            |65 (94.20%)            |        |
|      |1              |3 (5.88%)              |5 (7.25%)              |4 (5.80%)              |        |
|d2    |ui             |                       |                       |                       |0.873   |
|      |0              |43 (84.31%)            |58 (84.06%)            |60 (86.96%)            |        |
|      |1              |8 (15.69%)             |11 (15.94%)            |9 (13.04%)             |        |
|d2    |race           |                       |                       |                       |0.320   |
|      |black          |10 (19.61%)            |10 (14.49%)            |6 (8.70%)              |        |
|      |other          |18 (35.29%)            |27 (39.13%)            |22 (31.88%)            |        |
|      |white          |23 (45.10%)            |32 (46.38%)            |41 (59.42%)            |        |

把结果保存
```
write.csv(out,file= "1.csv",row.names = F)
```

**scitb1**比起**tb1**包功能远远比不上，主打一个简单实用，虽然没有tb1包这么强大的功能，但是可以快速出表，而且增加了连续变量的处理，还是有点优势的吧。之后我还打算出个视频介绍怎么基于scitb包快速生成表一，欢迎观看。

最后原创声明一下，**scitb**包遵循GPL-3协议，你可以自由使用、播散和修改，但是用于商业用途需要得到我的同意和授权。
