---
title: scitb包1.6版本发布，一个为制作专业统计表格而生的R包
author: 天桥下的卖艺者
date: '2023-12-06'
slug: scitb-1-6-r
categories:
  - 统计学
  - scitb
tags:
  - scitb
  - 统计学
  - 基线表格
from_Rmd: yes
---

scitb包~~1.6~~ 1.7版本已经正式在R语言官方CRAN上线，**scitb**包是一个为生成专业化统计表格而生的R包。

## 代码安装


```         
install.packages("scitb")
```

安装过旧版本的从新安装一次就可以升级了,根据粉丝的建议，增加了`Overall`参数对数据进行**汇总**的功能，增加了**连续卡方校正**和**fisher精确卡方**的功能。

## 数据演示
下面我来演示一下，**scitb**包生成结果需要**stringi**包和**nortest**包支持，这两个包你可以不导入，但要先安装好。

```         
install.packages(stringi)
install.packages(nortest)
```

安装好需要的包后我们就可以开始了，先导入R包和数据，**scitb**自带有早产数据，咱们直接从包调用



```r
library(scitb)
bc <- prematurity
# head(bc)
```


| id| low| age| lwt|race  |smoke     | ptl| ht| ui| ftv|  bwt|
|--:|---:|---:|---:|:-----|:---------|---:|--:|--:|---:|----:|
| 85|   0|  19| 182|black |nonsmoker |   0|  0|  1|   0| 2523|
| 86|   0|  33| 155|other |nonsmoker |   0|  0|  0|   3| 2551|
| 87|   0|  20| 105|white |smoker    |   0|  0|  0|   1| 2557|
| 88|   0|  21| 108|white |smoker    |   0|  0|  1|   2| 2594|
| 89|   0|  18| 107|white |smoker    |   0|  0|  1|   0| 2600|
| 91|   0|  21| 124|other |nonsmoker |   0|  0|  0|   0| 2622|
这是一个关于早产低体重儿的数据，低于2500g被认为是低体重儿。数据解释如下：
- low 是否是小于2500g早产低体重儿
- age 母亲的年龄
- lwt 末次月经体重
- race 种族
- smoke孕期抽烟
- ptl 早产史（计数）
- ht 有高血压病史
- ui 子宫过敏
- ftv 早孕时看医生的次数
- bwt 新生儿体重数值

绘制基线表的主要是`scitb1`函数（以后会有更多其他表格函数），本次我主要是介绍新功能，基础功能请看既往文章，咱们来看下它的函数体

```         
scitb1(vars,fvars=NULL,strata,data,dec,num,nonnormal=NULL,type=NULL,statistic=F,atotest=T,NormalTest=NULL,fisher=FALSE,correct=FALSE,Overall=FALSE)
```

咱们先来看一下具体含义：
- vars是变量的意思，你基线表中的变量放进去
- fvars是分类变量，就是你vars变量中的分类变量，如果没有的话就留空
- strata,就是分层的意思，这里填入你要研究的变量
- data这里填入你的数据
- dec就是你生成结果的小数点位数，默认是3位。

### 分类变量演示

假设咱们想`race`为研究目标，因为它是分类变量，咱们最好把它转成因子，因为**scitb**包有一定对数据类型的判定能力
> 如果你的分类变量类别大于5个，而你不转成因子的话，它可能自动判定为连续变量，处理方式不一样的，所以这里最好自己设定一下


```r
bc$race <- as.factor(bc$race)
```

接下来就是定义全部变量，分类变量和分层变量


```r
allVars <- c("age", "lwt", "smoke", "ptl", "ht", "ui", "ftv", "bwt")
fvars <- c("smoke", "ht", "ui")
strata <- "race"
```

### 一键生成统计结果


```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc)
```


|      |Characteristic |race.black             |race.other             |race.white             |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |26                     |67                     |96                     |        |
|d1    |age            |20.50 (17.25-24.00)    |22.00 (19.00-25.00)    |23.50 (20.00-29.00)    |0.027   |
|d1    |lwt            |129.00 (120.00-179.00) |119.00 (105.00-130.00) |129.50 (112.00-143.25) |<0.001  |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.867   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-1.25)       |0.103   |
|d1    |bwt            |2719.69±638.68         |2804.01±721.30         |3103.01±727.87         |0.008   |
|d2    |smoke          |                       |                       |                       |<0.001  |
|      |nonsmoker      |16 (61.54%)            |55 (82.09%)            |44 (45.83%)            |        |
|      |smoker         |10 (38.46%)            |12 (17.91%)            |52 (54.17%)            |        |
|d2    |ht             |                       |                       |                       |0.496   |
|      |0              |23 (88.46%)            |63 (94.03%)            |91 (94.79%)            |        |
|      |1              |3 (11.54%)             |4 (5.97%)              |5 (5.21%)              |        |
|d2    |ui             |                       |                       |                       |0.653   |
|      |0              |23 (88.46%)            |55 (82.09%)            |83 (86.46%)            |        |
|      |1              |3 (11.54%)             |12 (17.91%)            |13 (13.54%)            |        |

### 汇总结果
假如咱们论文需要汇总的结果，加上`Overall=T`


```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc, statistic = T,
  Overall = T)
```


|      |Characteristic |Overall                |race.black             |race.other             |race.white             |statistical value |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:----------------------|:-----------------|:-------|
|scinn |N              |189                    |26                     |67                     |96                     |                  |        |
|o.d   |age            |23.00 (19.00-26.00)    |20.50 (17.25-24.00)    |22.00 (19.00-25.00)    |23.50 (20.00-29.00)    |7.251             |0.027   |
|o.d   |lwt            |121.00 (110.00-140.00) |129.00 (120.00-179.00) |119.00 (105.00-130.00) |129.50 (112.00-143.25) |13.929            |<0.001  |
|o.d   |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.286             |0.867   |
|o.d   |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-1.25)       |4.548             |0.103   |
|o.d   |bwt            |2944.29±729.02         |2719.69±638.68         |2804.01±721.30         |3103.01±727.87         |4.949             |0.008   |
|d2    |smoke          |                       |                       |                       |                       |21.779            |<0.001  |
|      |nonsmoker      |115 (60.85%)           |16 (61.54%)            |55 (82.09%)            |44 (45.83%)            |                  |        |
|      |smoker         |74 (39.15%)            |10 (38.46%)            |12 (17.91%)            |52 (54.17%)            |                  |        |
|d2    |ht             |                       |                       |                       |                       |1.404             |0.496   |
|      |0              |177 (93.65%)           |23 (88.46%)            |63 (94.03%)            |91 (94.79%)            |                  |        |
|      |1              |12 (6.35%)             |3 (11.54%)             |4 (5.97%)              |5 (5.21%)              |                  |        |
|d2    |ui             |                       |                       |                       |                       |0.853             |0.653   |
|      |0              |161 (85.19%)           |23 (88.46%)            |55 (82.09%)            |83 (86.46%)            |                  |        |
|      |1              |28 (14.81%)            |3 (11.54%)             |12 (17.91%)            |13 (13.54%)            |                  |        |

### 连续性校正的卡方进行检验

如果你的数据比较特殊，如果**理论数T＜5但T≥1,并且n≥40**,需要用连续性校正的卡方进行检验.可以加上correct=T


```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc, statistic = T,
  Overall = T, fisher = F, correct = T  ## 连续性校正的卡方进行检验
)
```


|      |Characteristic |Overall                |race.black             |race.other             |race.white             |statistical value |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:----------------------|:-----------------|:-------|
|scinn |N              |189                    |26                     |67                     |96                     |                  |        |
|o.d   |age            |23.00 (19.00-26.00)    |20.50 (17.25-24.00)    |22.00 (19.00-25.00)    |23.50 (20.00-29.00)    |7.251             |0.027   |
|o.d   |lwt            |121.00 (110.00-140.00) |129.00 (120.00-179.00) |119.00 (105.00-130.00) |129.50 (112.00-143.25) |13.929            |<0.001  |
|o.d   |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.286             |0.867   |
|o.d   |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-1.25)       |4.548             |0.103   |
|o.d   |bwt            |2944.29±729.02         |2719.69±638.68         |2804.01±721.30         |3103.01±727.87         |4.949             |0.008   |
|d2    |smoke          |                       |                       |                       |                       |21.779            |<0.001  |
|      |nonsmoker      |115 (60.85%)           |16 (61.54%)            |55 (82.09%)            |44 (45.83%)            |                  |        |
|      |smoker         |74 (39.15%)            |10 (38.46%)            |12 (17.91%)            |52 (54.17%)            |                  |        |
|d2    |ht             |                       |                       |                       |                       |1.404             |0.496   |
|      |0              |177 (93.65%)           |23 (88.46%)            |63 (94.03%)            |91 (94.79%)            |                  |        |
|      |1              |12 (6.35%)             |3 (11.54%)             |4 (5.97%)              |5 (5.21%)              |                  |        |
|d2    |ui             |                       |                       |                       |                       |0.853             |0.653   |
|      |0              |161 (85.19%)           |23 (88.46%)            |55 (82.09%)            |83 (86.46%)            |                  |        |
|      |1              |28 (14.81%)            |3 (11.54%)             |12 (17.91%)            |13 (13.54%)            |                  |        |

### Fisher's检验
如果你**理论数T＜1或n＜40**,需要用到Fisher's检验.


```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc, statistic = T,
  Overall = T, fisher = T, correct = F)
```


|      |Characteristic |Overall                |race.black             |race.other             |race.white             |statistical value |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:----------------------|:-----------------|:-------|
|scinn |N              |189                    |26                     |67                     |96                     |                  |        |
|o.d   |age            |23.00 (19.00-26.00)    |20.50 (17.25-24.00)    |22.00 (19.00-25.00)    |23.50 (20.00-29.00)    |7.251             |0.027   |
|o.d   |lwt            |121.00 (110.00-140.00) |129.00 (120.00-179.00) |119.00 (105.00-130.00) |129.50 (112.00-143.25) |13.929            |<0.001  |
|o.d   |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.286             |0.867   |
|o.d   |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-1.25)       |4.548             |0.103   |
|o.d   |bwt            |2944.29±729.02         |2719.69±638.68         |2804.01±721.30         |3103.01±727.87         |4.949             |0.008   |
|d2    |smoke          |                       |                       |                       |                       |                  |<0.001  |
|      |nonsmoker      |115 (60.85%)           |16 (61.54%)            |55 (82.09%)            |44 (45.83%)            |                  |        |
|      |smoker         |74 (39.15%)            |10 (38.46%)            |12 (17.91%)            |52 (54.17%)            |                  |        |
|d2    |ht             |                       |                       |                       |                       |                  |0.538   |
|      |0              |177 (93.65%)           |23 (88.46%)            |63 (94.03%)            |91 (94.79%)            |                  |        |
|      |1              |12 (6.35%)             |3 (11.54%)             |4 (5.97%)              |5 (5.21%)              |                  |        |
|d2    |ui             |                       |                       |                       |                       |                  |0.689   |
|      |0              |161 (85.19%)           |23 (88.46%)            |55 (82.09%)            |83 (86.46%)            |                  |        |
|      |1              |28 (14.81%)            |3 (11.54%)             |12 (17.91%)            |13 (13.54%)            |                  |        |

大家注意一下，fisher精确卡方和连续校正卡方同时选的话，只会出fisher精确卡方的结果，第二就是fisher精确卡方是没有统计值的，咱们看SPSS的结果也是没有的

### 连续变量演示

怎么制表需要你自己想好来。连续变量也是差不多的，我简单跑一下把



```r
allVars <- c("race", "lwt", "smoke", "ptl", "ht", "ui", "ftv", "bwt")
fvars <- c("smoke", "ht", "ui", "race")
strata <- "age"
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc)
```

```
##       Min 33.33333% 66.66667%       Max 
##        14        20        25        45
```

```
## Strata is treated as a continuous variable.
```


|      |Characteristic |G.0                    |G.1                    |G.2                    |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |51                     |69                     |69                     |        |
|d1    |lwt            |119.00 (106.00-135.00) |121.00 (110.00-132.00) |130.00 (115.00-153.00) |0.086   |
|d1    |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.171   |
|d1    |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-2.00)       |0.011   |
|d1    |bwt            |2974.08±612.51         |2921.42±697.85         |2945.13±839.82         |0.927   |
|d2    |smoke          |                       |                       |                       |0.587   |
|      |nonsmoker      |28 (54.90%)            |44 (63.77%)            |43 (62.32%)            |        |
|      |smoker         |23 (45.10%)            |25 (36.23%)            |26 (37.68%)            |        |
|d2    |ht             |                       |                       |                       |0.929   |
|      |0              |48 (94.12%)            |64 (92.75%)            |65 (94.20%)            |        |
|      |1              |3 (5.88%)              |5 (7.25%)              |4 (5.80%)              |        |
|d2    |ui             |                       |                       |                       |0.873   |
|      |0              |43 (84.31%)            |58 (84.06%)            |60 (86.96%)            |        |
|      |1              |8 (15.69%)             |11 (15.94%)            |9 (13.04%)             |        |
|d2    |race           |                       |                       |                       |0.320   |
|      |black          |10 (19.61%)            |10 (14.49%)            |6 (8.70%)              |        |
|      |other          |18 (35.29%)            |27 (39.13%)            |22 (31.88%)            |        |
|      |white          |23 (45.10%)            |32 (46.38%)            |41 (59.42%)            |        |

红色字体并不是说明有错误，而是温馨提示你目前函数是把这个变量当做连续变量来处理，并告诉你分段的截点


### 添加汇总数据



```r
out <- scitb1(vars = allVars, fvars = fvars, strata = strata, data = bc, num = 4,
  Overall = T)
```

```
## Min 25% 50% 75% Max 
##  14  19  23  26  45
```

```
## Strata is treated as a continuous variable.
```


|      |Characteristic |Overall                |G.0                    |G.1                    |G.2                    |G.3                    |p value |
|:-----|:--------------|:----------------------|:----------------------|:----------------------|:----------------------|:----------------------|:-------|
|scinn |N              |189                    |35                     |59                     |41                     |54                     |        |
|o.d   |lwt            |121.00 (110.00-140.00) |115.00 (105.00-126.00) |125.00 (111.00-148.50) |118.00 (110.00-130.00) |132.50 (120.00-154.00) |0.001   |
|o.d   |ptl            |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.00 (0.00-0.00)       |0.384   |
|o.d   |ftv            |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |0.00 (0.00-1.00)       |1.00 (0.00-2.00)       |0.072   |
|o.d   |bwt            |2944.29±729.02         |2938.51±585.15         |2948.39±664.75         |2877.20±816.71         |2994.48±820.04         |0.896   |
|d2    |smoke          |                       |                       |                       |                       |0.186                  |smoke   |
|      |nonsmoker      |115 (60.85%)           |20 (57.14%)            |33 (55.93%)            |31 (75.61%)            |31 (57.41%)            |        |
|      |smoker         |74 (39.15%)            |15 (42.86%)            |26 (44.07%)            |10 (24.39%)            |23 (42.59%)            |        |
|d2    |ht             |                       |                       |                       |                       |0.413                  |ht      |
|      |0              |177 (93.65%)           |34 (97.14%)            |53 (89.83%)            |38 (92.68%)            |52 (96.30%)            |        |
|      |1              |12 (6.35%)             |1 (2.86%)              |6 (10.17%)             |3 (7.32%)              |2 (3.70%)              |        |
|d2    |ui             |                       |                       |                       |                       |0.277                  |ui      |
|      |0              |161 (85.19%)           |30 (85.71%)            |46 (77.97%)            |37 (90.24%)            |48 (88.89%)            |        |
|      |1              |28 (14.81%)            |5 (14.29%)             |13 (22.03%)            |4 (9.76%)              |6 (11.11%)             |        |
|d2    |race           |                       |                       |                       |                       |0.141                  |race    |
|      |black          |26 (13.76%)            |9 (25.71%)             |7 (11.86%)             |6 (14.63%)             |4 (7.41%)              |        |
|      |other          |67 (35.45%)            |13 (37.14%)            |21 (35.59%)            |17 (41.46%)            |16 (29.63%)            |        |
|      |white          |96 (50.79%)            |13 (37.14%)            |31 (52.54%)            |18 (43.90%)            |34 (62.96%)            |        |

其他的操作都差不多，我就不一一介绍了，想要详细了解的请看既往文章。
